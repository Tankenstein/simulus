(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{2:function(t,e,i){t.exports=i(6)},6:function(t,e,i){"use strict";i.r(e);var n=i(0),a=i.n(n),o=(i(5),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function r(t,e){navigator.serviceWorker.register(t).then(function(t){t.onupdatefound=function(){var i=t.installing;null!=i&&(i.onstatechange=function(){"installed"===i.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),e&&e.onUpdate&&e.onUpdate(t)):(console.log("Content is cached for offline use."),e&&e.onSuccess&&e.onSuccess(t)))})}}).catch(function(t){console.error("Error during service worker registration:",t)})}var c=i(1),u="com.ukutammet.ambusim.v1",l={id:"location",name:"location",description:"lat/lng of a hospital",dataType:n.PropertyDataType.GEOMETRY},s={id:"health",name:"health",description:"How ok this patient is on a scale of 1-5",dataType:n.PropertyDataType.NUMBER},d={id:"condition",name:"condition",description:"Is this patient stable or critical",dataType:n.PropertyDataType.STRING},p={id:"bedCount",name:"bed count",description:"how many beds a hospital has",dataType:n.PropertyDataType.NUMBER},m={id:"".concat(u,".hospital"),name:"Hospital",description:"What ambulances use as a station",ownProperties:[l,p]},h={id:"".concat(u,".patient"),name:"Patient",description:"A patient that might need help",ownProperties:[l,s,d]},f={id:"".concat(u,".ambulance"),name:"Ambulance",description:"An ambulance that drives around",ownProperties:[l]},y={id:"".concat(u,".model.accident"),name:"Start an accident at some place to create patients",parameterSchema:{type:"object",required:["latitude","longitude","magnitude","criticality"],properties:{latitude:{type:"number",title:"Latitude of accident"},longitude:{type:"number",title:"Longitude of accident"},radius:{type:"number",title:"Radius size of accident"},magnitude:{type:"integer",title:"Magnitude (how many people are effected, 1-2000)",minimum:1,maximum:2e3},criticality:{type:"integer",title:"Criticality (how bad was the average person affected, 1-5)",minimum:1,maximum:5}}},run:function(t,e,i){function a(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=Math.random()*(e-t)+t,o=Math.random()*n;return a*(1-o)+i*o}function o(t,e){return e*Math.random()*(Math.random()<.5?-1:1)+t}for(var r=0;r<e.magnitude;r++){var u=Object(n.createEntity)({typeId:h.id,name:"Patient ".concat(r)}),p={type:s,value:a(-1,5,5-e.criticality)};t.entities=t.entities.concat([Object(c.a)({},u,{type:h,archived:!1,properties:{location:{type:l,value:{x:o(e.latitude,e.radius),y:o(e.longitude,e.radius)}},health:p,condition:{type:d,value:p.value<2||p.value<3&&Math.random()<.5?"critical":"stable"}}})])}i(t)}},v={id:"".concat(u,".model.ambulanceAndPatientBehaviour"),name:"Ambulance/patient behaviour",parameterSchema:{type:"object",required:["time"],properties:{time:{type:"number",title:"Time to simulate, in minutes (0-1440)",minimum:0,maximum:1440}}},runInWorker:function(t,e,i){var n="".concat("com.ukutammet.ambusim.v1",".patient"),a="".concat("com.ukutammet.ambusim.v1",".ambulance"),o=6378100;function r(t){return t*(Math.PI/180)}function c(t,e){var i=r(e.x-t.x),n=r(e.y-t.y),a=Math.sin(i/2)*Math.sin(i/2)+Math.cos(r(t.x))*Math.cos(r(e.x))*Math.sin(n/2)*Math.sin(n/2),c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return o*c}for(var u=function(t){return t<20},l=function(){var e=t.entities.filter(function(t){return t.type.id===n&&t.properties.health.value>0}),i=e.filter(function(t){return"critical"===t.properties.condition.value}),o=t.entities.filter(function(t){return t.type.id===a});i.forEach(function(t){t.properties.health.value=t.properties.health.value-.05});var r={};o.forEach(function(t){var i,n=r[t.id],a=t.properties.location.value;if(!n&&a){var o=e.filter(function(t){var e=t.properties.condition.value,i=t.properties.location.value;return!(!e||!i)&&"critical"===e}).sort(function(t,e){var i=t.properties.location.value,n=e.properties.location.value;return c(a,i)-c(a,n)});if(o.length){var l=o[0],s=l.properties.location.value,d=c(a,s);u(d)?l.properties.condition.value="stable":r[t.id]=(i=s,JSON.parse(JSON.stringify(i)))}}}),Object.keys(r).forEach(function(e){var i=t.entities.find(function(t){return t.id===e}),n=i.properties.location.value,a=r[e];if(i&&n&&a){var o=c(n,a);if(u(o))delete r[e];else{var l=Math.min(666.4,o);n.x+=(a.x-n.x)/o*l,n.y+=(a.y-n.y)/o*l}}})};e.time--;)l();i(t)}},g={id:"".concat(u,".indicator.alivePatients"),name:"Alive patients",type:n.IndicatorType.VALUE,calculate:function(t){return t.entities.filter(function(t){return t.type.id===h.id&&t.properties.health.value>0}).length}},b={id:"".concat(u,".indicator.deadPatients"),name:"Dead patients",type:n.IndicatorType.VALUE,calculate:function(t){return t.entities.filter(function(t){return t.type.id===h.id&&t.properties.health.value<0}).length}},w={id:"".concat(u,".indicator.criticalPatients"),name:"Critical patients",type:n.IndicatorType.VALUE,calculate:function(t){return t.entities.filter(function(t){return t.type.id===h.id&&"critical"===t.properties.condition.value}).length}},T={id:"".concat(u,".indicator.stablePatients"),name:"Stable patients",type:n.IndicatorType.VALUE,calculate:function(t){return t.entities.filter(function(t){return t.type.id===h.id&&"critical"!==t.properties.condition.value}).length}},M={id:"".concat(u,".indicator.worldMap"),name:"World map",type:n.IndicatorType.MAP,calculate:function(t){var e=[];return t.entities.forEach(function(t){if(t.type.id===h.id){var i=t.properties.location.value,n=t.properties.health.value,a="critical"===t.properties.condition.value,o="green";n<0?o="black":n<2||a?o="red":n<3&&(o="yellow"),e.push({latitude:i.x,longitude:i.y,content:{icon:{color:o,name:"user"}}})}else if(t.type.id===f.id){var r=t.properties.location.value;e.push({latitude:r.x,longitude:r.y,content:{icon:{color:"blue",name:"ambulance"}}})}}),{mapBoxToken:"pk.eyJ1IjoidGFua2Vuc3RlaW4iLCJhIjoiY2p2NHlwZnhmMWg1dDQzcDk5ajhjNXdjeiJ9.2w-6uYLrlgHl1FTEpCBLaA",latitude:59.437,longitude:24.7536,zoom:10,markers:e}}},k={id:"".concat(u,".indicator.patientsByCondition"),type:n.IndicatorType.BAR,name:"Patients by health",calculate:function(t){function e(e){return t.entities.filter(function(t){return t.type.id===h.id&&e(t.properties.health.value)}).length}return[{x:"<= 1",y:e(function(t){return t<=1})},{x:"<= 2",y:e(function(t){return t<=2&&t>1})},{x:"<= 3",y:e(function(t){return t<=3&&t>2})},{x:"<= 4",y:e(function(t){return t<=4&&t>3})},{x:"<= 5",y:e(function(t){return t<=5&&t>4})}]}},x={id:u,name:"Ambusim",description:"Facilities to run basic and naive geographic ambulance simulations.",entityTypes:[m,h,f],models:[y,v],indicators:[M,b,g,w,T,k]};a()(document.getElementById("root"),{routerType:n.Options.RouterType.HASH,modules:[x]}),function(t){if("serviceWorker"in navigator){if(new URL("/simulus",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/simulus","/service-worker.js");o?(function(t,e){fetch(t).then(function(i){var n=i.headers.get("content-type");404===i.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(function(t){t.unregister().then(function(){window.location.reload()})}):r(t,e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e,t),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):r(e,t)})}}({})}},[[2,1,2]]]);
//# sourceMappingURL=main.adab9681.chunk.js.map